pipeline {
    agent any

    parameters {
        string(name: 'BUCKET_NAME', defaultValue: 'my-custom-bucket-from-jenkins', description: 'S3 bucket name')
    }

    environment {
        TF_VAR_bucket_name = "${params.BUCKET_NAME}"
    }

    stages {
        stage('Clone Terraform Repo') {
            steps {
                echo "Cloning Terraform Repo..."
                checkout scm
            }
        }

        stage('Terraform Apply (S3)') {
            steps {
                dir('s3') {
                    sh '''
                        terraform init
                        terraform plan
                        terraform apply --auto-approve
                    '''
                }
            }
        }

        stage('Confirm Creation') {
            steps {
                echo "S3 bucket '${params.BUCKET_NAME}' created successfully"
            }
        }
    }
}
